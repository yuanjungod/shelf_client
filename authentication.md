# 果小美智能设备认证设计

## Overview

果小美智能设备由于涉及交易，对设备及通信的安全要求较高。下面的设计用于满足终端与
设备网关之间的相互信任问题及通信的安全。

## 设备对网关的信任

设备与网关使用 TLS 与设备网关进行加密通信.

## 网关对设备的信任

每一台设备都有唯一的设备 ID, 设备 ID 用于设备网关对设备的身份标记. 但是设备 ID
是公开的不能用于安全通信.

### 安全级别

基于设备的使用场景，对安全级别做下列设计要求：

  1. 能防范中间人攻击.
  2. 能防范身份假冒.
  3. 能防范物理损坏外的身份获取.

### 身份认定

设备的身份认定使用外部确认机制, 当有一台或多台声称统一身份的设备连接设备网关时,
通过果小美的授权用户确认机制完成设备的身份认定. 身份认定成功后其他声称统一身份
的设备便会失效。

![identification](./imags/identification.jpg "身份认定")

### 设备认证

设备网关对设备的认证采用 Token 方式，Token 由设备网关随机生成并下发给设备。认证
Token 使用动态生成机制，设备在每次联网后都会随机生成新的 Token。

对于没有进行身份认定前，采用宽松的 Token 校验模式。允许有多个相同设备 ID 的设备
连接到设备网关。一旦设备完成身份认定，相同设备 ID 的其他设备就不能再连接网关。

#### 设备认证 - 身份认定前

设备身份认定前相同设备 ID 多个设备连接网关，Token 的更新、存储及生效情况。


![authentication before identification](./imags/authentication1.jpg "设备认证-身份认定前")

#### 设备认证 - 身份认定后

设备身份认定后相同设备 ID 多个设备连接网关，Token 的更新、存储及生效情况。


![authentication after identification](./imags/authentication2.jpg "设备认证-身份认定后")
